<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head>
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">


  <title>ITP Wiki for Various Uses | BigScreens / XBee </title>
  <meta http-equiv="Content-Style-Type" content="text/css">
  <link rel="stylesheet" href="XBee_fichiers/pmwiki.css" type="text/css">
  <script src="XBee_fichiers/pmwiki.js" type="text/javascript"></script>
  <!--HeaderText--><style type="text/css"><!--
  ul, ol, pre, dl, p { margin-top:0px; margin-bottom:0px; }
  code.escaped { white-space: nowrap; }
  .vspace { margin-top:1.33em; }
  .indent { margin-left:40px; }
  .outdent { margin-left:40px; text-indent:-40px; }
  a.createlinktext { text-decoration:none; border-bottom:1px dotted gray; }
  a.createlink { text-decoration:none; position:relative; top:-0.5em;
    font-weight:bold; font-size:smaller; border-bottom:none; }
  img { border:0px; }
   
  table.tabtable { border-collapse: collapse; }
  table.tabtable td { border:1px solid #cccccc; }
 
  table.tabtable { border-collapse: collapse; }
  table.tabtable td { border:1px solid #cccccc; }
.todo-form { border: none; }
.todo-form tr td { border: none; font-weight: plain; text-align: left; padding: 4px; }
.todo-form tr td.heading { text-align: right; width: 140px; padding-right: 6px; }
table.todo-list { border: 2px solid #ccc; }
table.todo-list tr.row1 { background-color: #eee; color: #555; }
table.todo-list tr.row1 td { border-bottom: 2px solid #ccc; }
table.todo-list tr:last-child.row1 td { border-bottom: none; }
table.todo-list th { background-color: #ddd; padding: 3px; font-weight: normal; border: 1px solid #ccc; color: #444; }
table.todo-list tr td { color: #666; }
table.todo-simple-list { margin-left: 0px; }
table.todo-simple-list tr td { border: none; padding: 4px; }
.todo-category-text { color: #666; border-bottom: 1px solid #ccc; }
.todo-description-text { color: #444; }
.todo-overdue-text { color: #f66; border-bottom: 1px solid #ccc; }
.todo-completed-text { color: #446600; border-bottom: 1px solid #ccc; }
.todo-legend { text-align: center; color: #555; font-size: smaller; }.editconflict { color:green; 
  font-style:italic; margin-top:1.33em; margin-bottom:1.33em; }

  table.markup { border:2px dotted #ccf; width:90%; }
  td.markup1, td.markup2 { padding-left:10px; padding-right:10px; }
  table.vert td.markup1 { border-bottom:1px solid #ccf; }
  table.horiz td.markup1 { width:23em; border-right:1px solid #ccf; }
  table.markup caption { text-align:left; }
  div.faq p, div.faq pre { margin-left:2em; }
  div.faq p.question { margin:1em 0 0.75em 0; font-weight:bold; }
   
    .frame 
      { border:1px solid #cccccc; padding:4px; background-color:#f9f9f9; }
    .lfloat { float:left; margin-right:0.5em; }
    .rfloat { float:right; margin-left:0.5em; }
a.varlink { text-decoration:none; }

--></style>  <meta name="robots" content="index,follow">

</head><body onload="JavaScript:checkCookies();">
<!--PageHeaderFmt-->
  <div id="wikilogo"><a href="http://itp.nyu.edu/varwiki"><img 
src="XBee_fichiers/tischitp.gif" alt="ITP Wiki for Various Uses" 
border="0"></a></div>
    <div id="pagetitle">XBee</div>
  <div id="wikihead">
  <form action="/varwiki">
    <input name="n" value="BigScreens.XBee" type="hidden">
    <input name="action" value="search" type="hidden">
    <a href="http://itp.nyu.edu/varwiki/Site/Search">Search</a>:
    <input name="q" class="inputbox searchbox" type="text">
    <input class="inputbutton searchbutton" value="Go" type="submit"></form></div>
<!--/PageHeaderFmt-->
  <table id="wikimid" cellpadding="5" cellspacing="5" width="100%"><tbody><tr>
      <td id="wikibody" valign="top">
<!--PageActionFmt-->
        <div id="wikicmds"><ul><li class="browse"><a accesskey="" 
class="selflink" href="http://itp.nyu.edu/varwiki/BigScreens/XBee">View</a>
</li><li class="print"><a accesskey="" rel="nofollow" class="wikilink" 
href="http://itp.nyu.edu/varwiki/BigScreens/XBee?action=print">Print</a>
</li><li class="recentchanges"><a accesskey="c" rel="nofollow" 
class="wikilink" 
href="http://itp.nyu.edu/varwiki/BigScreens/RecentChanges">Recent 
Changes</a>
</li><li><a class="wikilink" 
href="http://itp.nyu.edu/varwiki/BigScreens/XBee?action=login">Login</a>
</li></ul>
</div>
<!--PageTitleFmt-->
        <div id="wikititle">
          <div class="pagegroup"><a 
href="http://itp.nyu.edu/varwiki/BigScreens">BigScreens</a> / XBee</div>
	</div>
<!--PageText-->
<div id="wikitext">
<p>A great way for us to be able to combine ITP's physical computing 
talents with "Big Screens" is via the <span class="wikiword">XBee</span>
 radio.  
</p>
<div class="vspace"></div><h2>What is <span class="wikiword">ZigBee</span></h2>
<p>"<a class="urllink" href="http://en.wikipedia.org/wiki/ZigBee" 
rel="nofollow">ZigBee</a> is the name of a specification for a suite of 
high level communication protocols using small, low-power digital radios
 based on the IEEE 802.15.4 standard for wireless personal area networks
 (<span class="wikiword">WPANs</span>). <span class="wikiword">ZigBee</span>
 is targeted at RF applications that require a low data rate, long 
battery life, and secure networking."  
</p>
<div class="vspace"></div><h2>Useful Links:</h2>
<ul><li><a class="urllink" 
href="http://itp.nyu.edu/%7Eraf275/meshnetworking/XBee/" rel="nofollow">Rob
 Faludi's XBee Meshnetworking page</a>
</li><li><a class="urllink" 
href="http://rob.faludi.com/itp/XBee_DriveBy/XBee_DriveBy_presentaion.pdf"
 rel="nofollow">Rob's XBee DriveBy Presentation</a>
</li><li><a class="urllink" href="http://www.maxstream.net/" 
rel="nofollow">Maxstreams</a> -- company that makes <span 
class="wikiword">XBee</span> radios
</li><li><a class="urllink" 
href="http://www.maxstream.net/products/xbee/manual_xb_oem-rf-modules_802.15.4.pdf"
 rel="nofollow">The XBee Manual</a>
</li><li><a class="urllink" 
href="http://rob.faludi.com/preorder/index.html" rel="nofollow">Links 
for where to buy supplies</a>
</li></ul><div class="vspace"></div><h2>What do you need to get started?</h2>
<ul><li>It's up to you to create your own P-comp device with <span 
class="wikiword">XBee</span> that will send information.  This page 
documents some steps to follow to get your data into a Big Screens 
application using the <a class="urllink" 
href="http://mostpixelsever.com/" rel="nofollow">MPE Library</a>.
</li><li>You should make sure to <a class="urllink" 
href="http://social.itp.nyu.edu/cgi-bin/itpwiki/wiki.cgi?ZigBee" 
rel="nofollow">sign up for your own PAN ID</a> so that your project 
doesn't conflict with others on the floor.  The PAN ID we will use for 
the <span class="wikiword">XBee</span> with our 6 screens set-up is 9990
 (note the example uses Rob's ID: 3333).
</li><li>Here is a list of supplies you might need: <a class="urllink" 
href="http://rob.faludi.com/preorder/index.html" rel="nofollow">http://rob.faludi.com/preorder/index.html</a>
</li></ul><div class="vspace"></div><h2>A Basic (No Microcontroller) 
Example</h2>
<p><span class="wikiword">XBee</span> radios can read digital and analog
 data (and broadcast that data) without the use of a microcontroller. 
You can have up to seven channels of analog input and nine channels of 
digital I/O.   Read <a class="urllink" 
href="http://itp.nyu.edu/%7Eraf275/blog/archives/2006/12/xbee_direct_io.html"
 rel="nofollow">Rob Faludi's post</a> on how to set-up your <span 
class="wikiword">XBee</span> for digital and analog data.
</p>
<p class="vspace">Our class example will assume the following: 
</p><ul><li>1 <span class="wikiword">XBee</span> radio with input 0 in 
analog mode (connected to a photocell).  
</li><li>1 <span class="wikiword">XBee</span> radio connected via USB to
 your computer
</li></ul><p class="vspace">Here are the settings for the output <span 
class="wikiword">XBee</span> radio (attached to the photocell).  You can
 configure the <span class="wikiword">XBee</span> using a USB dongle and
 sending commands via <a class="urllink" 
href="http://homepage.mac.com/dalverson/zterm/" rel="nofollow">ZTerm</a>.
</p>
<div class="vspace"></div><pre class="escaped">+++      --&gt; Enter into Command mode
ATID3333 --&gt; PAN ID  (using Rob Faludi's ID for now, we will use 9990 eventually, or use your own)
ATMY0    --&gt; my address 1
ATDL1    --&gt; destination address 1 (broadcast to Xbee below)
ATD02    --&gt; input 0 in analog mode
ATIR64   --&gt; sample rate 100 milliseconds (hex 64)
ATIT1    --&gt; transmitting just 1 sample!
ATWR     --&gt; write settings to firmware
</pre>
<p class="vspace">And the input <span class="wikiword">XBee</span> radio
 connected to our computer.
</p>
<div class="vspace"></div><pre class="escaped">+++      --&gt; Enter into Command mode
ATID3333 --&gt; PAN ID  (using Rob Faludi's ID for now, we will use 9990 eventually, or use your own)
ATMY1    --&gt; my address 1
ATDL0    --&gt; destination address 0 (we don't have a destination for now)
ATDH0    --&gt; destination address 0
</pre>
<p class="vspace">Because the input Xbee is connected to the computer, 
we do not have to write the above settings to the firmware.  Instead, we
 can take care of this using the Processing serial library and resetting
 the Xbee (ATRE) each time, i.e.
</p>
<div class="vspace"></div><pre class="escaped">port.write("+++");
delay(1100);                                   // Default guard time for XBee
port.write("ATRE,ID3333,MY1,DH0,DL0,CN\r\n");  // Setup XBee
</pre>
<p class="vspace">Assuming your Xbees are configured correctly, bytes 
will start arriving via the Serial port in Processing.  The full 
protocol is described in detail in the <a class="urllink" 
href="http://www.maxstream.net/products/xbee/manual_xb_oem-rf-modules_802.15.4.pdf"
 rel="nofollow">Xbee manual</a>.  In our example, the bytes will come in
 as follows:
</p>
<div class="vspace"></div><pre class="escaped">0x7e          --&gt; Start Byte (this is hexademical)
Length MSB    --&gt; High Byte for length of packet
Length LSB    --&gt; Low Byte for length of packet
API_ID        --&gt; Identifies what kind of packet this is
Address MSB   --&gt; High Byte for address of source (this is useful if we have readings from multiple sources!)
Address LSB   --&gt; Low Byte for address of source
RSSI          --&gt; Received Signal Strength Indicator
Options       --&gt; Some stuff that is not important
totalSamples  --&gt; This is just going to be 1 for us, but could be more later!!
Channel MSB   --&gt; Which channels are in use
Channel LSB   --&gt; Which channels are in use
Data MSB      --&gt; The data itself (will be multiple times if multiple sensors)
Data LSB      --&gt; The data itself (will be multiple times if multiple sensors)
Checksum      --&gt; Used to confirm that all the data was read correctly
</pre>
<p class="vspace">Assuming you have a Processing Serial object, you can 
read all the bytes in the above order and parse them.  For example, this
 is how you might start:
</p>
<div class="vspace"></div><pre class="escaped">while (port.available() &lt; 1) {
  ; // do nothing while we wait for the buffer to fill
}
// Ok there is at least one byte available
if (port.available() &gt;= 1) {
  // Read that byte
  int inByte = port.read();
  // It is the start byte?
  if (inByte == 0x7E) {
    while (port.available() &lt; 2) {
      ; // do nothing while we wait for the buffer to fill
    }
    // Two more bytes are available
    if (port.available() &gt;= 2) {
      int lengthMSB = port.read(); // high byte for length of packet
      int lengthLSB = port.read(); // low byte for length of packet
      // Look, this is how you can put low and high byte together!!!
      int length = (lengthLSB + (lengthMSB &lt;&lt; 8));
</pre>
<p class="vspace">A bit more parsing and eventually you'd get to the 
sensor data you want!  Fortunately for us, Rob Faludi has created an 
example that does most of this work and I've adapted it into a simpler 
Processing library for use in Eclipse.  So you don't have to do the 
above, unless you are doing something highly specialized.
</p>
<div class="vspace"></div><h2>Using the <span class="wikiword">XBeeReader</span>
 library</h2>
<p>The full example is on the CVS, under:
</p>
<p class="vspace">/home/dts204/bigscreens/examples2009
</p>
<p class="vspace">PROJECT:  <span class="wikiword">XBee</span>
</p>
<p class="vspace">The class that does the work for you is called <span 
class="wikiword">XBeeReader</span>.java.  In order to make an <span 
class="wikiword">XBeeReader</span> object, you need to pass in a 
reference to the current <span class="wikiword">PApplet</span> (this) as
 well as a Serial object (It's your job to create the Serial object with
 the right port, etc.)  You must then call the function start(), which 
will begin the processing of reading the Xbee data.
</p>
<div class="vspace"></div><pre class="escaped">Serial port;
XBeeReader xbee;

public void setup() {
  size(200, 200);
  // Print a list in case COM1 doesn't work out
  // println("Available serial ports:");
  println(Serial.list());
  port = new Serial(this, Serial.list()[0], 9600);
  xbee = new XBeeReader(this,port);
  xbee.start();
}
</pre>
<p class="vspace"><span class="wikiword">XBee</span> data will arrive in
 an xBeeEvent() function, just like serialEvent():
</p>
<div class="vspace"></div><pre class="escaped">public void xBeeEvent(XBeeReader xbee) {
  int data = xbee.getXBeeReading();
  //println(data);
}
</pre>
<p class="vspace">The example is only set up to send back a single 
integer.  If you want to read from multiple analog and digital inputs, 
you'll need to refer to the manual and change the getData() function 
inside <span class="wikiword">XBeeReader</span>.java.
</p>
<div class="vspace"></div><h2>Serial in Eclipse</h2>
<p>For serial to work in Eclipse, copy over the entire library folder 
from Processing. You will then need to add the following jars to your 
build path:
</p><ul><li>serial.jar
</li><li><span class="wikiword">RXTXComm</span>.jar
</li></ul><p class="vspace">Then right-click on <span class="wikiword">RXTXComm</span>.jar,
 select "Properties", "Native Library" and pick the folder in your 
project where the native files (JNILIB for mac, DLL for PC) are stored.
</p>
<div class="vspace"></div><h2>Using <span class="wikiword">XBee</span> 
data with MPE</h2>
<p>For a multi-screen application, you'll want to make sure that a 
single client creates and initializes the <span class="wikiword">XBee</span>
 object.
</p>
<div class="vspace"></div><pre class="escaped">if (client.getID() == 0) {
  println(Serial.list());
  port = new Serial(this, Serial.list()[0], 9600);
  xbee = new XBeeReader(this,port);
  xbee.start();
}
</pre>
<p class="vspace">As soon as you read the data from the <span 
class="wikiword">XBee</span>, you'll want to turn right around and 
broadcast it out to all clients.
</p>
<div class="vspace"></div><pre class="escaped">public void xBeeEvent(XBeeReader xbee) {
  int data = xbee.getXBeeReading();
  client.broadcast("" + data);
}
</pre>
<p class="vspace">Remember, do not use the value directly or you risk 
going out of sync!!!   Then, you can receive and use the data in 
frameEvent():
</p>
<div class="vspace"></div><pre class="escaped">public void frameEvent(Client c){
  if (c.messageAvailable()) {
    String[] msg = c.getDataMessage();
    x = Integer.parseInt(msg[0]);
  }
}
</pre>
<p class="vspace">See mpe/<span class="wikiword">XBeeMPE</span>.java in 
the <span class="wikiword">XBee</span> project on the CVS for an 
implementation of the above.
</p>
<div class="vspace"></div>
</div>

      </td>
    </tr></tbody></table>
<!--PageFooterFmt-->
  <div id="wikifoot">
    <div class="footnav">
      <ul><li class="browse"><a accesskey="" class="selflink" 
href="http://itp.nyu.edu/varwiki/BigScreens/XBee">View</a>
</li><li class="print"><a accesskey="" rel="nofollow" class="wikilink" 
href="http://itp.nyu.edu/varwiki/BigScreens/XBee?action=print">Print</a>
</li><li class="recentchanges"><a accesskey="c" rel="nofollow" 
class="wikilink" 
href="http://itp.nyu.edu/varwiki/BigScreens/RecentChanges">Recent 
Changes</a>
</li><li><a class="wikilink" 
href="http://itp.nyu.edu/varwiki/BigScreens/XBee?action=login">Login</a>
</li></ul>
<a href="http://itp.nyu.edu/varwiki/Site/Search">Search</a></div>
    <div class="lastmod">&nbsp;&nbsp;Page last modified on October 04, 
2009, at 11:08 PM</div></div>
<!--/PageFooterFmt-->
</body></html>